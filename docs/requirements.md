# 需求说明

## 目标

构建一个面向运营/分析人员的「B 站爆款视频抓取后台管理系统」，支持任务配置、抓取运行、视频库管理、指标看板与告警提醒。当前版本以打通流程为主，默认使用 Mock 数据源，爬虫模式可切换。

## 角色与场景

- 运营/内容分析：配置关键词与规则，批量筛选爆款与低粉爆款视频。
- 管理员：监控任务执行与异常告警，调整系统抓取配置。

## 功能需求

### 1) 任务管理

- 任务 CRUD：创建/编辑/删除任务。
- 任务字段：
  - 关键词 `keywords`、排除词 `exclude_words`
  - 抓取范围 `scope`（天数、分区、抓取条数、排序）
  - 执行计划 `schedule`（仅支持 daily + time）
  - 规则 `rules`（爆款/低粉爆款阈值）
- 启用/停用任务。
- 任务复制（基于原任务配置生成新任务）。
- 任务搜索与分页。
- 任务汇总（今日新增/爆款/低粉爆款、近 7 天成功率、最近一次运行结果）。

### 2) 运行与监控

- 手动运行任务（同步/异步）。
- 任务试跑（dry-run，不落库，仅返回样本与计数）。
- 运行历史列表与运行详情。
- 失败运行重试。

### 3) 视频库

- 视频列表（多维筛选/排序/分页）：
  - 任务、标签（爆款/低粉爆款）、处理状态
  - 发布时间/抓取时间区间
  - 指标阈值（播放、收藏、投币、评论、比率等）
- 视频详情。
- 处理状态更新（todo/done）与备注。
- 批量操作：
  - 批量更新处理状态
  - 批量提取字幕
  - 批量下载封面
- CSV 导出（自定义字段与缺失补全）。

### 4) 指标与看板

- 总览：今日新增、今日爆款、今日低粉爆款、失败任务数、成功率、最近运行时间。
- 趋势：近 N 天新增/爆款/低粉爆款/运行成功趋势。
- 任务排行：按近 N 天产出视频数排序。

### 5) 告警

- 失败告警列表（可读/未读）。
- 标记已读 / 全部已读。
- 未读数量。

### 6) 系统设置

- 抓取限速、重试次数、超时。
- 连续失败告警阈值。

### 7) 任务模板

- 预置模板（行业 + 强度）。
- 模板 CRUD。

## 非功能与约束

- API 统一前缀：`/api`，返回 JSON。
- 分页统一为 `page` / `page_size` / `total`。
- 时间字段统一为 UTC 时间（后端以 `datetime.utcnow()` 记录）。
- 默认使用 Mock 数据源，不真实抓取；爬虫模式需配置 `.env`。

## 暂不支持

- 权限/鉴权体系。
- 多租户与组织隔离。
- 真实 B 站抓取的稳定性保障（需自行扩展爬虫）。
